<html>
    <!-- This Demo overlays a rigged hand on top of the existing page.  Requires a WebGL-capable browser. -->
    <head>
        <link rel="stylesheet" href="js/leapjs-playback/stylesheets/controls.css">
        <link rel="stylesheet" href="js/leapjs-playback/stylesheets/data-collection.css">
        <link rel="stylesheet" href="js/leapjs-playback/stylesheets/main.css">
        <link rel="stylesheet" href="js/leapjs-playback/stylesheets/lib/angular.rangeSlider.css">
        <link rel="stylesheet" href="js/leapjs-playback/stylesheets/lib/xeditable.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

        <!--        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>-->
        <script src="js/leapjs-playback/javascripts/lib/angular.js"></script>
        <script src="js/leapjs-playback/javascripts/lib/angular.rangeSlider.js"></script>
        <script src="js/leapjs-playback/javascripts/lib/angular-spinner.min.js"></script>
        <script src="js/leapjs-playback/javascripts/lib/xeditable.min.js"></script>
        <script src="js/leapjs-playback/javascripts/lib/angulartics.min.js"></script>
        <script src="js/leapjs-playback/javascripts/lib/angulartics-ga.min.js"></script>
        <script src="js/three/three.min.js"></script>
        <script src="js/leapjs/leap-0.6.4.min.js"></script>
        <script src="//js.leapmotion.com/leap-plugins-0.1.12.min.js"></script>
        <script src="//js.leapmotion.com/leap.rigged-hand-0.1.7.min.js"></script>
        <script src="js/leapjs-playback/javascripts/data-collection.js"></script>
        <script src="js/leapjs-playback/build/leap.playback-0.2.1.js"></script>
        <script src="js/leapjs-playback/javascripts/controls.js"></script>
        <script src="js/leapjs-playback/javascripts/metadata.js"></script>
        <script src="js/leapjs-playback/javascripts/recorder.js"></script>
    </head>
    <body ng-app="Recorder" class="ng-scope">

        <!-- handle html5 file drag/drop -->
        <div id="dropzone">
            <span>
                Set Recording
            </span>
        </div>

        <!-- For the time being, this controller manages recordings which get used -->
        <div data-ng-controller="DataCollection" ng-show="mode == 'crop' || mode == 'playback'" class="ng-scope ng-hide">

            <section class="row ng-hide" id="changeRecording" ng-animate="'animate'" ng-show="mode == 'intro'">

                <div class="col-xs-2 changeRecordingControl">
                    <button ng-click="previous($event)" class="btn btn-default btn-double">
                        <i class="glyphicon glyphicon-chevron-left"></i>
                    </button>
                </div>

                <div class="col-xs-8">
                    <h2 class="ng-binding">recordings/pinch-57fps</h2>
                    <p class="recordingDescription ng-binding"></p>

                    <div class="pull-right">
                        <button class="btn btn-default" ng-click="replay($event)" ng-disabled="!canReplay()" disabled="disabled">
                            Replay
                        </button>
                        <button class="btn btn-default btn-success" ng-click="record()">
                            Make Recording
                        </button>
                    </div>
                </div>

                <div class="col-xs-2 changeRecordingControl" style="text-align: right;">
                    <button ng-click="next($event)" class="btn btn-default btn-double">
                        <i class="glyphicon glyphicon-chevron-right"></i>
                    </button>
                </div>
                <div class="clearfix"></div>
            </section>

            <!-- todo: leap-enable! -->
            <section class="row ng-hide" id="acceptRecording" ng-animate="'animate'" ng-show="mode == 'outro'">
                <div class="col-xs-8 col-xs-offset-2">
                    <h2>Deliver Recording?</h2>
                    <p class="recordingDescription">
                    </p>
                    <div class="pull-right">
                        <button class="btn btn-default" ng-click="discard()">Discard</button>
                        <button class="btn btn-primary" ng-click="save()">Save &amp; Send</button>
                    </div>
                </div>
            </section>
            <hr>
        </div>

        <div id="controls" data-ng-controller="Controls" class="ng-scope">
            <div class="ngrs-range-slider ng-isolate-scope ngrs-horizontal" id="range" pin-handle="min" range-slider="" min="0" max="recordingLength()" model-min="leftHandlePosition" model-max="rightHandlePosition" ng-show="mode == 'crop' || mode == 'playback'"><div class="ngrs-runner"><div class="ngrs-handle ngrs-handle-min" style="display: none; left: 0%;"><i></i></div><div class="ngrs-handle ngrs-handle-max" style="display: block; left: 100%;"><i></i></div><div class="ngrs-join" style="left: 0%; right: 0%;"></div></div><div class="ngrs-value-runner"><div class="ngrs-value ngrs-value-min" ng-show="showValues"><div class="ng-binding">0</div></div><div class="ngrs-value ngrs-value-max" ng-show="showValues"><div class="ng-binding">132</div></div></div></div>

            <div class="btn-group btn-group-lg dropup">

                <button type="button" class="btn btn-default" ng-click="record()" ng-class="{active: mode == 'record'}" id="record">

                    <i class="glyphicon glyphicon-record" ng-class="{orange: recordPending(), red: recording()}"></i>

                    <span class="hotkey">R</span>ecord

                </button>

                <button type="button" class="btn btn-default" ng-click="crop()" ng-class="{active: mode == 'crop'}" ng-disabled="canPlayBack()" id="crop">

                    <span style="margin-top: -2px; display: inline-block; vertical-align: top;">[ ]</span>

                    <span class="hotkey">C</span>rop

                </button>

                <button style="text-align: left" type="button" class="btn btn-default active" ng-click="playback()" ng-class="{active: mode == 'playback'}" ng-disabled="canPlayBack()">

                    <span ng-show="player().loading()" us-spinner="{radius:4, width:2, length: 4, left: '20px'}" style="width: 18px; display: inline-block;" class="ng-scope ng-hide"><div class="spinner" role="progressbar" style="position: absolute; width: 0px; z-index: 2000000000; left: 20px; top: 50%;"><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-0-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(0deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-1-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(30deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-2-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(60deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-3-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(90deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-4-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(120deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-5-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(150deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-6-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(180deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-7-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(210deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-8-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(240deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-9-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(270deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-10-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(300deg) translate(4px, 0px); border-radius: 1px;"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-11-12 1s linear infinite;"><div style="position: absolute; width: 6px; height: 2px; background: rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(330deg) translate(4px, 0px); border-radius: 1px;"></div></div></div></span>

                    <span ng-show="!player().loading() & amp; & amp; !pauseOnPlaybackButtonClick()" class="">▶</span>

                    <span ng-show="!player().loading() & amp; & amp; pauseOnPlaybackButtonClick()" class="ng-hide"><i class="glyphicon glyphicon-pause"></i></span>

                    <span class="hotkey">P</span>layback

                </button>

            </div>



            <div class="btn-group btn-group-lg dropup" style="text-align: left;">
                <button type="button" class="btn btn-default" ng-click="save()">Download</button>
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="#" ng-click="save()"><b>Compressed</b></a></li>
                    <li><a href="#" ng-click="save('json')">As JSON</a></li>
                </ul>
            </div>

            <div class="pull-right">
                <a href="#" onclick="$('#helpModal').modal('toggle')">
                    <!-- todo: should change href to help and use angular router.. -->
                    <i class="glyphicon glyphicon-info-sign help-modal-control"></i>
                </a>
            </div>

        </div>

        <!--
         Bootstrap requires tabindex=-1 for escape key :-/
         http://stackoverflow.com/questions/12630156/how-do-you-enable-the-escape-key-close-functionality-in-a-twitter-bootstrap-moda
        -->
        <div class="modal fade" id="helpModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- https://github.com/blog/273-github-ribbons -->
                    <a target="_blank" href="https://github.com/leapmotion/leapjs-playback"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 1;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a>
                    <div class="modal-header">
                        <h4 class="modal-title">Shortcuts</h4>
                    </div>
                    <div class="modal-body">
                        <table>
                            <tbody><tr>
                                    <td>r</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>record</td>
                                </tr>
                                <tr>
                                    <td>c</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>crop</td>
                                </tr>
                                <tr>
                                    <td>p</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>playback</td>
                                </tr>
                                <tr>
                                    <td>s</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>save/download</td>
                                </tr>
                                <tr>
                                    <td>f</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>fullscreen</td>
                                </tr>
                                <tr>
                                    <td>m</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>show metadata</td>
                                </tr>
                                <tr>
                                    <td>?</td>
                                    <td> &nbsp;:&nbsp;</td>
                                    <td>help</td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        Drag 'n' drop to set recording.
                                    </td>
                                </tr>
                            </tbody></table>
                        <br>
                        <div class="pull-right" style="margin-top: 1em;">
                            <a href="https://github.com/leapmotion/leapjs-playback" target="_blank">Docs</a>
                        </div>
                        <h4>Usage</h4>
                        <hr>
                        <pre><code class=" hljs actionscript">  <span class="hljs-keyword">var</span> controller = <span class="hljs-keyword">new</span> Leap.Controller();
  controller
    .<span class="hljs-keyword">use</span>(<span class="hljs-string">'playback'</span>, {
      recording: <span class="hljs-string">'leap-playback-recording-110fps.json.lz'</span>
    })
    .connect()</code></pre>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade ng-scope" id="metadata" data-ng-controller="Metadata" tabindex="-1" ng-keypress="stripKeycodes($event)">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">Metadata</h4>
                    </div>

                    <div class="modal-body">


                        <table>

                            <tbody><tr>
                                    <td>title</td>
                                    <td>
                                        <a href="#" editable-text="metadata.title" class="ng-scope ng-binding editable editable-click">
                                            recordings/pinch-57fps
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>
                                        <a href="#" editable-textarea="metadata.description" e-rows="2" e-cols="40" class="ng-scope ng-binding editable editable-click editable-empty">
                                            Edit
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>formatVersion</td>
                                    <td class="ng-binding">2</td>
                                </tr>
                                <tr>
                                    <td>frameRate</td>
                                    <td class="ng-binding">57</td>
                                </tr>
                                <tr>
                                    <td>frames</td>
                                    <td class="ng-binding">133</td>
                                </tr>
                                <tr>
                                    <td>generatedBy</td>
                                    <td class="ng-binding">LeapJS Playback 0.2.1</td>
                                </tr>
                                <tr>
                                    <td>protocolVersion</td>
                                    <td class="ng-binding"></td>
                                </tr>
                                <tr>
                                    <td>url</td>
                                    <td class="ng-binding"></td>
                                </tr>
                            </tbody></table>
                    </div>
                </div>
            </div>
        </div>


        <div id="connect-leap" style="width: 100%; position: absolute; top: 0px; left: 0px; padding: 10px; text-align: center; font-size: 18px; opacity: 0.8; display: none; z-index: 10; cursor: pointer;"></div>

        <!--        <div id="controls" data-ng-controller="Controls" class="ng-scope">
                    <div class="ngrs-range-slider ng-isolate-scope ngrs-horizontal" id="range" max="recordingLength()" min="0" model-max="rightHandlePosition" model-min="leftHandlePosition" ng-show="mode == 'crop' || mode == 'playback'" pin-handle range-slider></div>
                    <div class="btn-group btn-group-lg dropup">
                        <button id="record" class="btn btn-default" ng-click="record()" type="button">Record</button>
                    </div>
                    
                </div>-->

        <script>
            (window.controller = new Leap.Controller({background: true}))
                    .use('playback', {
                    loop: false,
                            pauseHotkey: false,
                            pauseOnHand: false
                    })
                    .use('riggedHand')
                    .connect();
            window.controller.on('frame', function (frame) {
            var hand = frame.hands[0];
            if (hand) {
//                    var handMesh = frame.hands[0].data('riggedHand.mesh');
//                    //to use screenPosition, we pass in any leap vector3 and the camera
//                    var screenPosition = handMesh.screenPosition(hand.fingers[1].tipPosition);
//                    console.log(screenPosition.x, screenPosition.y);
//                    console.log(hand);
            }
            });
        </script>
    </body>
</html>